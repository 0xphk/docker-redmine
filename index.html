<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Docker Redmine by sameersbn</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/sameersbn/docker-redmine">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/sameersbn/docker-redmine/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/sameersbn/docker-redmine/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Docker Redmine</h1>
          <p>A Dockerfile that installs redmine, apache, mysql and a bunch of redmine plugins and themes</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/sameersbn">sameersbn</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a name="table-of-contents" class="anchor" href="#table-of-contents"><span class="octicon octicon-link"></span></a>Table of Contents</h1>

<ul>
<li>
<a href="#introduction">Introduction</a>

<ul>
<li><a href="#version">Version</a></li>
<li><a href="Changelog.md">Changelog</a></li>
</ul>
</li>
<li><a href="#installation">Installation</a></li>
<li><a href="#quick-start">Quick Start</a></li>
<li>
<a href="#configuration">Configuration</a>

<ul>
<li><a href="#data-store">Data Store</a></li>
<li>
<a href="#database">Database</a>

<ul>
<li>
<a href="#mysql">MySQL</a>

<ul>
<li><a href="#internal-mysql-server">Internal MySQL Server</a></li>
<li><a href="#external-mysql-server">External MySQL Server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mail">Mail</a></li>
<li><a href="#putting-it-all-together">Putting it all together</a></li>
<li><a href="#available-configuration-parameters">Available Configuration Parameters</a></li>
</ul>
</li>
<li>
<a href="#maintenance">Maintenance</a>

<ul>
<li><a href="#ssh-login">SSH Login</a></li>
</ul>
</li>
<li><a href="#upgrading">Upgrading</a></li>
<li><a href="#references">References</a></li>
</ul><h1>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h1>

<p>Dockerfile to build a Redmine container image (with some additional themes and plugins).</p>

<h2>
<a name="version" class="anchor" href="#version"><span class="octicon octicon-link"></span></a>Version</h2>

<p>Current Version: 2.5.0</p>

<h1>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Pull the image from the docker index. This is the recommended method of installation as it is easier to update image in the future. These builds are performed by the Trusted Build service.</p>

<div class="highlight highlight-bash"><pre>docker pull sameersbn/redmine
</pre></div>

<p>Since version 2.4.2, the image builds are being tagged. You can now pull a particular version of redmine by specifying the version number. For example,</p>

<div class="highlight highlight-bash"><pre>docker pull sameersbn/redmine:2.5.0
</pre></div>

<p>Alternately you can build the image yourself.</p>

<div class="highlight highlight-bash"><pre>git clone https://github.com/sameersbn/docker-redmine.git
<span class="nb">cd </span>docker-redmine
docker build -t<span class="o">=</span><span class="s2">"$USER/redmine"</span> .
</pre></div>

<h1>
<a name="quick-start" class="anchor" href="#quick-start"><span class="octicon octicon-link"></span></a>Quick Start</h1>

<p>Run the redmine image with the name "redmine".</p>

<div class="highlight highlight-bash"><pre>docker run -name redmine -d sameersbn/redmine
<span class="nv">REDMINE_IP</span><span class="o">=</span><span class="k">$(</span>docker inspect redmine <span class="p">|</span> grep IPAddres <span class="p">|</span> awk -F<span class="s1">'"'</span> <span class="s1">'{print $4}'</span><span class="k">)</span>
</pre></div>

<p>Access the Redmine application</p>

<div class="highlight highlight-bash"><pre>xdg-open <span class="s2">"http://${REDMINE_IP}"</span>
</pre></div>

<p><strong>NOTE</strong>: Please allow a minute or two for the Redmine application to start.</p>

<p>Login using the default username and password:</p>

<ul>
<li>username: admin</li>
<li>password: admin</li>
</ul><p>You should now have Redmine ready for testing. If you want to use Redmine for more than just testing then please read the <strong>Advanced Options</strong> section.</p>

<h1>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h1>

<h2>
<a name="data-store" class="anchor" href="#data-store"><span class="octicon octicon-link"></span></a>Data Store</h2>

<p>For the file storage we need to mount a volume at the following location.</p>

<ul>
<li>/redmine/files</li>
</ul><p>Volumes can be mounted in docker by specifying the <strong>'-v'</strong> option in the docker run command.</p>

<div class="highlight highlight-bash"><pre>mkdir -pv /opt/redmine/files
docker run -name redmine -d <span class="se">\</span>
  -v /opt/redmine/files:/redmine/files sameersbn/redmine
</pre></div>

<h2>
<a name="database" class="anchor" href="#database"><span class="octicon octicon-link"></span></a>Database</h2>

<p>Redmine uses a database backend to store its data.</p>

<h3>
<a name="internal-mysql-server" class="anchor" href="#internal-mysql-server"><span class="octicon octicon-link"></span></a>Internal MySQL Server</h3>

<p>This docker image is configured to use a MySQL database backend. The database connection can be configured using environment variables. If not specified, the image will start a mysql server internally and use it. However in this case, the data stored in the mysql database will be lost if the container is stopped/deleted. To avoid this you should mount a volume at /var/lib/mysql.</p>

<div class="highlight highlight-bash"><pre>mkdir /opt/redmine/mysql
docker run -name redmine -d <span class="se">\</span>
  -v /opt/redmine/files:/redmine/files <span class="se">\</span>
  -v /opt/redmine/mysql:/var/lib/mysql sameersbn/redmine
</pre></div>

<p>This will make sure that the data stored in the database is not lost when the image is stopped and started again.</p>

<h4>
<a name="external-mysql-server" class="anchor" href="#external-mysql-server"><span class="octicon octicon-link"></span></a>External MySQL Server</h4>

<p>The image can be configured to use an external MySQL database instead of starting a MySQL server internally. The database configuration should be specified using environment variables while starting the Redmine image.</p>

<p>Before you start the Redmine image create user and database for redmine.</p>

<div class="highlight highlight-bash"><pre>mysql -uroot -p
CREATE USER <span class="s1">'redmine'</span>@<span class="s1">'%.%.%.%'</span> IDENTIFIED BY <span class="s1">'password'</span><span class="p">;</span>
CREATE DATABASE IF NOT EXISTS <span class="sb">`</span>redmine_production<span class="sb">`</span> DEFAULT CHARACTER SET <span class="sb">`</span>utf8<span class="sb">`</span> COLLATE <span class="sb">`</span>utf8_unicode_ci<span class="sb">`</span><span class="p">;</span>
GRANT SELECT, LOCK TABLES, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER ON <span class="sb">`</span>redmine_production<span class="sb">`</span>.* TO <span class="s1">'redmine'</span>@<span class="s1">'%.%.%.%'</span><span class="p">;</span>
</pre></div>

<p><em>Assuming that the mysql server host is 192.168.1.100</em></p>

<div class="highlight highlight-bash"><pre>docker run -name redmine -d <span class="se">\</span>
  -e <span class="s2">"DB_HOST=192.168.1.100"</span> -e <span class="s2">"DB_NAME=redmine_production"</span> <span class="se">\</span>
  -e <span class="s2">"DB_USER=redmine"</span> -e <span class="s2">"DB_PASS=password"</span> <span class="se">\</span>
  -v /opt/redmine/files:/redmine/files sameersbn/redmine
</pre></div>

<p>This will initialize the redmine database and after a couple of minutes your redmine instance should be ready to use.</p>

<h3>
<a name="mail" class="anchor" href="#mail"><span class="octicon octicon-link"></span></a>Mail</h3>

<p>The mail configuration should be specified using environment variables while starting the redmine image. The configuration defaults to using gmail to send emails and requires the specification of a valid username and password to login to the gmail servers.</p>

<p>The following environment variables need to be specified to get mail support to work.</p>

<ul>
<li>SMTP_HOST (defaults to smtp.gmail.com)</li>
<li>SMTP_PORT (defaults to 587)</li>
<li>SMTP_USER</li>
<li>SMTP_PASS</li>
</ul><div class="highlight highlight-bash"><pre>docker run -name redmine -d <span class="se">\</span>
  -e <span class="s2">"SMTP_USER=USER@gmail.com"</span> -e <span class="s2">"SMTP_PASS=PASSWORD"</span> <span class="se">\</span>
  -v /opt/redmine/files:/redmine/files sameersbn/redmine
</pre></div>

<p>If you are not using google mail, then please configure the  SMTP host and port using the SMTP_HOST and SMTP_PORT configuration parameters.</p>

<p><strong>NOTE:</strong></p>

<p>I have only tested standard gmail and google apps login. I expect that the currently provided configuration parameters should be sufficient for most users. If this is not the case, then please let me know.</p>

<h3>
<a name="putting-it-all-together" class="anchor" href="#putting-it-all-together"><span class="octicon octicon-link"></span></a>Putting it all together</h3>

<div class="highlight highlight-bash"><pre>docker run -name redmine -d -h redmine.local.host <span class="se">\</span>
  -v /opt/redmine/files:/redmine/files <span class="se">\</span>
  -v /opt/redmine/mysql:/var/lib/mysql <span class="se">\</span>
  -e <span class="s2">"SMTP_USER=USER@gmail.com"</span> -e <span class="s2">"SMTP_PASS=PASSWORD"</span> <span class="se">\</span>
  sameersbn/redmine
</pre></div>

<p>If you are using an external mysql database</p>

<div class="highlight highlight-bash"><pre>docker run -name redmine -d -h redmine.local.host <span class="se">\</span>
  -v /opt/redmine/files:/redmine/files <span class="se">\</span>
  -e <span class="s2">"DB_HOST=192.168.1.100"</span> -e <span class="s2">"DB_NAME=redmine_production"</span> -e <span class="s2">"DB_USER=redmine"</span> -e <span class="s2">"DB_PASS=password"</span> <span class="se">\</span>
  -e <span class="s2">"SMTP_USER=USER@gmail.com"</span> -e <span class="s2">"SMTP_PASS=PASSWORD"</span> <span class="se">\</span>
  sameersbn/redmine
</pre></div>

<h3>
<a name="available-configuration-parameters" class="anchor" href="#available-configuration-parameters"><span class="octicon octicon-link"></span></a>Available Configuration Parameters</h3>

<p>Below is the complete list of parameters that can be set using environment variables.</p>

<ul>
<li>
<strong>DB_HOST</strong>: The mysql server hostname. Defaults to localhost.</li>
<li>
<strong>DB_PORT</strong>: The mysql server port. Defaults to 3306.</li>
<li>
<strong>DB_NAME</strong>: The mysql database name. Defaults to redmine_production</li>
<li>
<strong>DB_USER</strong>: The mysql database user. Defaults to root</li>
<li>
<strong>DB_PASS</strong>: The mysql database password. Defaults to no password</li>
<li>
<strong>DB_POOL</strong>: The mysql database connection pool count. Defaults to 5.</li>
<li>
<strong>MEMCACHED_SIZE</strong>: The local memcached size in Mb. Defaults to 64. Disabled if '0'.</li>
<li>
<strong>SMTP_HOST</strong>: SMTP server host. Defaults to smtp.gmail.com.</li>
<li>
<strong>SMTP_PORT</strong>: SMTP server port. Defaults to 587.</li>
<li>
<strong>SMTP_USER</strong>: SMTP username.</li>
<li>
<strong>SMTP_PASS</strong>: SMTP password.</li>
<li>
<strong>PASSENGER_MAX_POOL_SIZE</strong>: PassengerMaxPoolSize (default: 6)</li>
<li>
<strong>PASSENGER_MIN_INSTANCES</strong>: PassengerMinInstances (default: 1)</li>
<li>
<strong>PASSENGER_MAX_REQUESTS</strong>: PassengerMaxRequests (default: 0)</li>
<li>
<strong>PASSENGER_POOL_IDLE_TIME</strong>: PassengerPoolIdleTime (default: 300)</li>
</ul><h2>
<a name="maintenance" class="anchor" href="#maintenance"><span class="octicon octicon-link"></span></a>Maintenance</h2>

<h3>
<a name="ssh-login" class="anchor" href="#ssh-login"><span class="octicon octicon-link"></span></a>SSH Login</h3>

<p>There are two methods to gain root login to the container, the first method is to add your public rsa key to the authorized_keys file and build the image.</p>

<p>The second method is use the dynamically generated password. Every time the container is started a random password is generated using the pwgen tool and assigned to the root user. This password can be fetched from the docker logs.</p>

<div class="highlight highlight-bash"><pre>docker logs redmine 2&gt;<span class="p">&amp;</span>1 <span class="p">|</span> grep <span class="s1">'^User: '</span> <span class="p">|</span> tail -n1
</pre></div>

<p>This password is not persistent and changes every time the image is executed.</p>

<h2>
<a name="upgrading" class="anchor" href="#upgrading"><span class="octicon octicon-link"></span></a>Upgrading</h2>

<p>To upgrade to newer redmine releases, simply follow this 5 step upgrade procedure.</p>

<p><strong>Step 1</strong>: Stop the currently running image</p>

<div class="highlight highlight-bash"><pre>docker stop redmine
</pre></div>

<p><strong>Step 2</strong>: Backup the database in case something goes wrong.</p>

<div class="highlight highlight-bash"><pre>mysqldump -h &lt;mysql-server-ip&gt; -uredmine -p --add-drop-table redmine_production &gt; redmine.sql
</pre></div>

<p><strong>Step 3</strong>: Update the docker image.</p>

<div class="highlight highlight-bash"><pre>docker pull sameersbn/redmine
</pre></div>

<p><strong>Step 4</strong>: Migrate the database.</p>

<div class="highlight highlight-bash"><pre>docker run -name redmine -i -t -rm <span class="o">[</span>OPTIONS<span class="o">]</span> sameersbn/redmine app:db:migrate
</pre></div>

<p><strong>Step 5</strong>: Start the image</p>

<div class="highlight highlight-bash"><pre>docker run -name redmine -i -d <span class="o">[</span>OPTIONS<span class="o">]</span> sameersbn/redmine
</pre></div>

<h2>
<a name="references" class="anchor" href="#references"><span class="octicon octicon-link"></span></a>References</h2>

<ul>
<li><a href="http://www.redmine.org/">http://www.redmine.org/</a></li>
<li><a href="http://www.redmine.org/projects/redmine/wiki/Guide">http://www.redmine.org/projects/redmine/wiki/Guide</a></li>
<li><a href="http://www.redmine.org/projects/redmine/wiki/RedmineInstall">http://www.redmine.org/projects/redmine/wiki/RedmineInstall</a></li>
</ul>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>